import{J as m,k as f,m as P,p as L,G as M,c as $,q as s,a as i,S as k,s as n,L as l,w as b,a7 as Y,a8 as W,a6 as e,o as U}from"./chunks/framework.Bev6ATEH.js";import{s as Z,c as C,b as v,j as g,w as r,y as H,x as G,k as D,b0 as S,o as J,G as j,aK as z,e as Q,bp as K,bZ as c,bS as ss,bU as is}from"./chunks/theme.DAWdUpF4.js";import{a as I}from"./chunks/alphabet.Chdqe_eo.js";import{c as _}from"./chunks/crimea.CzKt3FDd.js";const as=e("",2),ts=s("a",{href:"https://en.wikipedia.org/wiki/Florence_Nightingale#Crimean_War",target:"_blank",rel:"noreferrer"},"deaths in the Crimean War",-1),ns=e("",4),es=e("",4),ls=e("",4),hs=e("",2),ks=s("strong",null,"order",-1),ps=s("em",null,"appearance",-1),rs=s("a",{href:"https://en.wikipedia.org/wiki/Recording_Industry_Association_of_America",target:"_blank",rel:"noreferrer"},"recording industry",-1),os={class:"label-input"},Es=s("option",null,"null",-1),ds=s("option",null,"appearance",-1),gs=s("option",null,"inside-out",-1),cs=s("option",null,"sum",-1),ys=s("option",null,"group",-1),us=s("option",null,"z",-1),Fs=[Es,ds,gs,cs,ys,us],ms=e("",4),fs={class:"label-input"},bs=e("",4),Cs=e("",3),vs={class:"label-input"},_s=s("option",null,"null",-1),Bs=s("option",null,"center",-1),qs=s("option",null,"wiggle",-1),xs=[_s,Bs,qs],As=e("",3),Ts=s("em",null,"normalize",-1),ws=s("strong",null,"offset",-1),Ps=e("",3),Ys=e("",3),Ds=s("a",{href:"https://en.wikipedia.org/wiki/Likert_scale",target:"_blank",rel:"noreferrer"},"Likert scale",-1),Ss=s("strong",null,"offset",-1),js=e("",39),Rs=JSON.parse('{"title":"Stack transform","description":"","frontmatter":{},"headers":[],"relativePath":"transforms/stack.md","filePath":"transforms/stack.md"}'),zs={name:"transforms/stack.md"},Ls=Object.assign(zs,{setup(Is){const B=m([]),y=f("wiggle"),X=P(()=>y.value==="null"?null:y.value),u=f("appearance"),O=P(()=>u.value==="null"?null:u.value),F=f(!0),o=m([]),q=m([]),E=Z({color:{type:"categorical"}}).range;L(()=>{C("../data/riaa-us-revenue.csv",v).then(p=>o.value=p),C("../data/survey.csv",v).then(p=>q.value=p),C("../data/us-congress-2023.csv",v).then(p=>B.value=p)});function V(p){const h=new Map(p);return{order:Array.from(h.keys()),offset(t,a,A,N){for(const R of t)for(const T of R){const w=is(T,d=>(A[d]-a[d])*(1-h.get(N[d])))/2;for(const d of T)a[d]-=w,A[d]-=w}}}}const x=V([["Strongly Disagree",-1],["Disagree",-1],["Neutral",0],["Agree",1],["Strongly Agree",1]]);return(p,h)=>{const t=M("PlotRender");return U(),$("div",null,[as,s("p",null,[i("For example, below is a stacked area chart of "),ts,i(" — predominantly from "),s("span",{style:k({borderBottom:`solid ${n(E)[0]} 3px`})},"disease",4),i(" — using Florence Nightingale’s data.")]),l(t,{options:{y:{grid:!0},color:{legend:!0},marks:[g(n(_),{x:"date",y:"deaths",fill:"cause"}),r([0])]}},null,8,["options"]),ns,l(t,{options:{y:{grid:!0},marks:[H(n(_),{x:"date",y:"deaths",interval:"month",fill:"cause"}),r([0])]}},null,8,["options"]),es,l(t,{options:{x:{interval:"month",tickFormat:a=>a.toLocaleString("en",{month:"narrow"}),label:null},y:{grid:!0},marks:[G(n(_),{x:"date",y:"deaths",fill:"cause"}),r([0])]}},null,8,["options"]),ls,l(t,{options:{x:{percent:!0},marks:[D(n(I),S({x:"frequency",fillOpacity:.3,inset:.5})),J(n(I),S({x:"frequency",text:"letter",inset:.5})),j([0,1])]}},null,8,["options"]),hs,s("p",null,[i("The "),ks,i(" option controls the order in which the layers are stacked. It defaults to null, meaning to respect the input order of the data. The "),ps,i(" order excels when each series has a prominent peak, as in the chart below of "),rs,i(" revenue. "),s("span",{style:k({borderBottom:`solid 2px ${n(E)[0]}`})},"Compact disc",4),i(" sales started declining well before the rise of "),s("span",{style:k({borderBottom:`solid 2px ${n(E)[1]}`})},"downloads",4),i(" and "),s("span",{style:k({borderBottom:`solid 2px ${n(E)[3]}`})},"streaming",4),i(", suggesting that the industry was slow to provide a convenient digital product and hence lost revenue to piracy.")]),s("p",null,[s("label",os,[i(" Order: "),b(s("select",{"onUpdate:modelValue":h[0]||(h[0]=a=>u.value=a)},Fs,512),[[Y,u.value]])])]),l(t,{defer:"",options:{y:{grid:!0,label:"Annual revenue (billions, adj.)",transform:a=>a/1e3},color:{legend:!0},marks:[g(o.value,{x:"year",y:"revenue",z:"format",fill:"group",order:O.value}),r([0])]}},null,8,["options"]),ms,s("p",null,[s("label",fs,[i(" Reverse: "),b(s("input",{type:"checkbox","onUpdate:modelValue":h[1]||(h[1]=a=>F.value=a)},null,512),[[W,F.value]])])]),l(t,{defer:"",options:{y:{grid:!0,label:"Annual revenue (billions, adj.)",transform:a=>a/1e3},color:{legend:!0},marks:[g(o.value,z({order:"appearance",reverse:F.value},{x:"year",y:"revenue",z:"format",fill:"group"})),r([0])]}},null,8,["options"]),bs,l(t,{defer:"",options:{y:{grid:!0,label:"Annual revenue (billions, adj.)",transform:a=>a/1e3},marks:[g(o.value,{x:"year",y:"revenue",z:"format",fill:"group",order:"value"}),r([0])]}},null,8,["options"]),Cs,s("p",null,[s("label",vs,[i(" Offset: "),b(s("select",{"onUpdate:modelValue":h[2]||(h[2]=a=>y.value=a)},xs,512),[[Y,y.value]])])]),l(t,{defer:"",options:{y:{grid:!0,label:"Annual revenue (billions, adj.)",transform:a=>a/1e3},marks:[g(o.value,{x:"year",y:"revenue",z:"format",fill:"group",offset:X.value})]}},null,8,["options"]),As,s("p",null,[i("The "),Ts,i(),ws,i(" is again worth special mention: it scales stacks to fill the interval [0, 1], thereby showing the relative proportion of each layer. Sales of "),s("span",{style:k({borderBottom:`solid 2px ${n(E)[0]}`})},"compact discs",4),i(" accounted for over 90% of revenue in the early 2000’s, but now most revenue comes from "),s("span",{style:k({borderBottom:`solid 2px ${n(E)[3]}`})},"streaming",4),i(".")]),l(t,{defer:"",options:{y:{label:"Annual revenue (%)",percent:!0},marks:[g(o.value,z({offset:"normalize",order:"group",reverse:!0},{x:"year",y:"revenue",z:"format",fill:"group"})),r([0,1])]}},null,8,["options"]),Ps,l(t,{defer:"",options:{aspectRatio:1,x:{label:"Age (years)"},y:{grid:!0,label:"← Women · Men →",labelAnchor:"center",tickFormat:Math.abs},marks:[Q(B.value,K({x:a=>2023-a.birthday.getUTCFullYear(),y:a=>a.gender==="M"?1:-1,fill:"gender",title:"full_name"})),r([0])]}},null,8,["options"]),Ys,s("p",null,[i("When visualizing "),Ds,i(" survey results we may wish to place "),s("span",{style:k({borderWidth:2,borderBottomStyle:"solid",borderImage:`linear-gradient(to right, ${c[5][0]}, ${c[5][1]}) 2`})},"negative",4),i(" (disagreeing) responses on the left and "),s("span",{style:k({borderWidth:2,borderBottomStyle:"solid",borderImage:`linear-gradient(to right, ${c[5][3]}, ${c[5][4]}) 2`})},"positive",4),i(" (agreeing) responses on the right, leaving "),s("span",{style:k({borderBottom:`solid 2px ${c[5][2]}`})},"neutral",4),i(" responses in the middle. This is achieved below using a custom "),Ss,i(" function.")]),l(t,{defer:"",options:{x:{tickFormat:Math.abs},color:{domain:n(x).order,scheme:"RdBu",legend:!0},marks:[D(q.value,ss({x:"count"},{fy:"Question",fill:"Response",...n(x)})),j([0])]}},null,8,["options"]),js])}}});export{Rs as __pageData,Ls as default};
